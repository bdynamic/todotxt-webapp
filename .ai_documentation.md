# Todo.txt Webapp AI Documentation

## Project Overview
This project is a Progressive Web Application (PWA) for managing tasks using the [todo.txt format](https://github.com/todotxt/todo.txt). It provides a web interface to view, add, and manage todo items, with a backend that syncs data using Git.

**Key Technologies:**
- **Runtime:** Node.js
- **Backend Framework:** Express.js
- **Frontend:** Vanilla JavaScript (ES Modules), Bootstrap 5, jQuery (slim)
- **Data Persistence:** Local `todo.txt` files + Git (via `simple-git`)
- **Containerization:** Docker & Docker Compose

## File Structure
- **`node-server.js`**: The main entry point for the backend server. Sets up Express, handles API requests, and serves static files.
- **`lib/git-backend.js`**: Core logic for Git integration. Handles repo initialization, file operations (read/write/rename/delete), SSH key management, and remote sync.
- **`assets/js/`**: Frontend logic.
  - `todo.js`: Main application logic.
  - `git-sync.js`: Handles frontend Git sync UI and interactions.
  - `todo-ui.js`, `todo-files.js`, etc.: Modularized frontend components.
- **`index.html`**: The single-page application entry point.
- **`docker-compose.yml`**: Configuration for running the application in a container.
- **`debug-docker.sh`**: Interactive shell script for debugging and testing the Docker container.
- **`package.json`**: Node.js dependencies (`express`, `simple-git`) and scripts.

## Development Environment
The project is designed to run via Docker Compose.

**Start command:**
```bash
docker-compose up
```

**Directories:**
- **`/workspace`**: Root of the project.
- **`/tmp/tododata`**: (Container) Default directory for storing `todo.txt` files and the `.git` repository. Mapped to a volume or local path in `docker-compose.yml`.
- **`/root/.config/todotxt-git`**: (Container) Directory for storing SSH keys and Git configuration.

## Backend Logic (`node-server.js` & `lib/git-backend.js`)
The backend provides a RESTful API for file and Git operations.

**Key API Endpoints:**
- `GET /api/git/status`: Get current Git status (ahead/behind, modified files, etc.).
- `GET /api/git/config` / `POST /api/git/config`: Get/Set Git user info and remote URL.
- `GET /api/git/files`: List all `.txt` files in the data directory.
- `GET /api/git/file/:filename`: Read file content and last commit info.
- `POST /api/git/file/:filename`: Write content to file and commit.
- `POST /api/git/rename`: Rename a file.
- `DELETE /api/git/file/:filename`: Delete a file.
- `POST /api/git/sync`: Trigger a sync with the remote repository (pull --rebase, push).

**Git Workflow:**
1.  **Init:** Initializes a git repo in `TODO_DATA_DIR` if one doesn't exist.
2.  **SSH:** Generates Ed25519 SSH keys for remote authentication.
3.  **Sync:** 
    - Fetches from remote.
    - Pulls changes (rebase).
    - Pushes local commits to remote.
    - Handles conflicts (basic detection).

## Frontend Logic
The frontend is a PWA that communicates with the backend API.
- **`todo.js`**: Initializes the app, loads files, and handles user interactions (add/edit/delete todos).
- **`git-sync.js`**: Manages the Git sync status indicator, configuration modal, and manual sync triggering.
- **Service Worker:** `service-worker.js` caches assets for offline use.

## Testing & Verification
There are **NO automated test suites** (e.g., Jest, Mocha) in the codebase.
Verification is done via:
1.  **Manual Testing**: Using the web interface.
2.  **`debug-docker.sh`**: This script contains a `test_api()` function that uses `curl` to verify API endpoints.
    - Run: `./debug-docker.sh` -> Select option `8`.

## Common Tasks

**Adding a dependency:**
```bash
npm install <package_name>
# Then rebuild the docker image
docker-compose build
```

**Debugging:**
- Use `./debug-docker.sh` to view logs, inspect the data directory, or open a shell in the container.
- Check logs: `docker-compose logs -f todo-webapp`.

**Environment Variables:**
- `DEBUG=true`: Enables verbose logging in `git-backend.js`.
- `TODO_DATA_DIR`: Path to todo files (default: `/tmp/tododata`).
- `TODO_CONFIG_DIR`: Path to config (default: `~/.config/todotxt-git`).
